{% extends "admin_base.html" %} {% block page_title %}{% if testimonial %}Edit
Testimonial{% else %}New Testimonial{% endif %}{% endblock %} {% block
page_subtitle %}{% if testimonial %}Update testimonial information{% else %}Add
a new farmer testimonial{% endif %}{% endblock %} {% block extra_css %}
<style>
  .form-container {
    max-width: 900px;
  }

  .form-group {
    margin-bottom: 25px;
  }

  .form-group label {
    display: block;
    color: var(--purple-light);
    font-weight: 600;
    margin-bottom: 10px;
    font-size: 1rem;
  }

  .form-control {
    width: 100%;
    padding: 12px 20px;
    background: var(--dark-accent);
    border: 2px solid rgba(108, 92, 231, 0.3);
    border-radius: 10px;
    color: var(--text-light);
    font-size: 1rem;
    transition: all 0.3s ease;
  }

  .form-control:focus {
    outline: none;
    border-color: var(--purple-primary);
    background: var(--dark-secondary);
  }

  .form-control::placeholder {
    color: var(--text-muted);
  }

  textarea.form-control {
    min-height: 150px;
    resize: vertical;
  }

  .form-help {
    display: block;
    margin-top: 8px;
    color: var(--text-muted);
    font-size: 0.9rem;
  }

  .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
  }

  .checkbox-group {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-top: 10px;
  }

  .checkbox-group input[type="checkbox"] {
    width: 20px;
    height: 20px;
    cursor: pointer;
  }

  .checkbox-group label {
    margin: 0;
    cursor: pointer;
  }

  .rating-group {
    display: flex;
    gap: 10px;
    margin-top: 10px;
  }

  .rating-option {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 10px 20px;
    background: var(--dark-secondary);
    border: 2px solid rgba(108, 92, 231, 0.3);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .rating-option:hover {
    border-color: var(--purple-primary);
  }

  .rating-option input[type="radio"] {
    cursor: pointer;
  }

  .rating-option.selected {
    background: linear-gradient(
      135deg,
      var(--purple-primary) 0%,
      var(--blue-accent) 100%
    );
    border-color: var(--purple-primary);
  }

  .image-preview {
    margin-top: 15px;
    padding: 20px;
    background: var(--dark-secondary);
    border-radius: 10px;
    text-align: center;
  }

  .image-preview img {
    max-width: 150px;
    max-height: 150px;
    border-radius: 50%;
    border: 4px solid var(--purple-primary);
  }

  .results-editor {
    background: var(--dark-secondary);
    padding: 20px;
    border-radius: 10px;
    margin-top: 10px;
  }

  .results-editor p {
    color: var(--text-muted);
    margin-bottom: 10px;
    font-size: 0.9rem;
  }

  .form-actions {
    display: flex;
    gap: 15px;
    margin-top: 30px;
    flex-wrap: wrap;
  }

  .btn-submit {
    padding: 12px 30px;
    background: linear-gradient(135deg, var(--success) 0%, #00b894 100%);
    border: none;
    color: white;
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .btn-submit:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px rgba(0, 210, 211, 0.4);
  }

  .btn-cancel {
    padding: 12px 30px;
    background: var(--dark-accent);
    border: 2px solid rgba(108, 92, 231, 0.3);
    color: var(--text-light);
    border-radius: 10px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    text-decoration: none;
    display: inline-block;
  }

  .btn-cancel:hover {
    border-color: var(--purple-primary);
    color: var(--purple-light);
  }

  @media (max-width: 768px) {
    .form-row {
      grid-template-columns: 1fr;
    }

    .rating-group {
      flex-wrap: wrap;
    }
  }
</style>
{% endblock %} {% block content %}
<div class="content-card">
  <div class="form-container">
    <form method="POST">
      <div class="form-row">
        <div class="form-group">
          <label for="name">Farmer Name *</label>
          <input
            type="text"
            id="name"
            name="name"
            class="form-control"
            placeholder="e.g., Rajesh Kumar"
            value="{{ testimonial.name if testimonial else '' }}"
            required
          />
        </div>

        <div class="form-group">
          <label for="location">Location *</label>
          <input
            type="text"
            id="location"
            name="location"
            class="form-control"
            placeholder="e.g., Haryana, Punjab"
            value="{{ testimonial.location if testimonial else '' }}"
            required
          />
        </div>
      </div>

      <div class="form-group">
        <label for="image">Profile Image URL *</label>
        <input
          type="url"
          id="image"
          name="image"
          class="form-control"
          placeholder="https://example.com/image.jpg"
          value="{{ testimonial.image if testimonial else '' }}"
          required
          oninput="updateImagePreview()"
        />
        <small class="form-help"
          >Enter image URL (use https://i.pravatar.cc/200?img=12 for demo
          avatars)</small
        >

        <div class="image-preview" id="imagePreview" style="display: none">
          <img id="previewImg" src="" alt="Preview" />
        </div>
      </div>

      <div class="form-group">
        <label>Rating *</label>
        <div class="rating-group">
          {% for i in range(1, 6) %}
          <label class="rating-option" onclick="selectRating({{ i }})">
            <input type="radio" name="rating" value="{{ i }}" {% if testimonial
            and testimonial.rating == i %}checked{% elif not testimonial and i
            == 5 %}checked{% endif %} required >
            <span
              >{{ i }} <i class="fas fa-star" style="color: #ffd700"></i
            ></span>
          </label>
          {% endfor %}
        </div>
      </div>

      <div class="form-group">
        <label for="testimonial">Testimonial Text *</label>
        <textarea
          id="testimonial"
          name="testimonial"
          class="form-control"
          placeholder="Enter the farmer's testimonial message..."
          required
        >
{{ testimonial.testimonial if testimonial else '' }}</textarea
        >
        <small class="form-help">The farmer's experience and feedback</small>
      </div>

      <div class="form-group">
        <label for="results">Key Results</label>
        <div class="results-editor">
          <p><strong>Enter each result on a new line:</strong></p>
          <textarea
            id="results"
            name="results"
            class="form-control"
            placeholder="25% increase in crop yield
35% reduction in water usage
â‚¹8 lakhs additional annual income"
            rows="5"
          >
{% if testimonial %}{{ testimonial.results|join('\n') }}{% endif %}</textarea
          >
        </div>
        <small class="form-help"
          >Enter bullet points one per line (leave blank if not
          applicable)</small
        >
      </div>

      <div class="form-group">
        <div class="checkbox-group">
          <input
            type="checkbox"
            id="featured"
            name="featured"
            {%
            if
            testimonial
            and
            testimonial.featured
            %}checked{%
            endif
            %}
          />
          <label for="featured">Mark as Featured Testimonial</label>
        </div>
        <small class="form-help"
          >Featured testimonials appear prominently on the page</small
        >
      </div>

      <div class="form-actions">
        <button type="submit" class="btn-submit">
          <i class="fas fa-save"></i> {% if testimonial %}Update{% else
          %}Create{% endif %} Testimonial
        </button>
        <a href="{{ url_for('admin_testimonials') }}" class="btn-cancel">
          <i class="fas fa-times"></i> Cancel
        </a>
      </div>
    </form>
  </div>
</div>
{% endblock %} {% block extra_js %}
<script>
  function updateImagePreview() {
    const imageInput = document.getElementById('image');
    const preview = document.getElementById('imagePreview');
    const previewImg = document.getElementById('previewImg');

    if (imageInput.value.trim()) {
      previewImg.src = imageInput.value;
      preview.style.display = 'block';
    } else {
      preview.style.display = 'none';
    }
  }

  function selectRating(rating) {
    document.querySelectorAll('.rating-option').forEach(opt => {
      opt.classList.remove('selected');
    });
    event.currentTarget.classList.add('selected');
  }

  // Initialize preview and rating if editing
  {% if testimonial %}
  updateImagePreview();
  document.querySelectorAll('.rating-option').forEach(opt => {
    if (opt.querySelector('input').checked) {
      opt.classList.add('selected');
    }
  });
  {% else %}
  // Select 5 stars by default
  document.querySelectorAll('.rating-option')[4].classList.add('selected');
  {% endif %}
</script>
{% endblock %}
